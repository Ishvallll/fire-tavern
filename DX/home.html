<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Global chat ig</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" href="../Untitled995_20251227113851.png">

  <style>
    :root{
      --b1:#282D31; --b2:#2D3238; --b3:#383E45;
      --u0:#0444BC; --o0:#FF8B44; --e0:#2B223E;
      --muted:rgba(255,255,255,.65);
    }
    html,body{height:100%;margin:0;background:var(--b2);color:#fff;font-family:system-ui}
    .container{max-width:980px;margin:80px auto 120px;padding:16px;display:flex;flex-direction:column;height:calc(100vh - 200px)}
    .header{display:flex;justify-content:space-between;align-items:center}
    .chat{flex:1;overflow-y:auto;background:rgba(0,0,0,.2);padding:12px;border-radius:10px}
    .msg{display:flex;gap:10px;margin:8px 0}
    .avatar{width:36px;height:36px;border-radius:8px;background:var(--b3);display:flex;align-items:center;justify-content:center;font-weight:700}
    .bubble{background:rgba(0,0,0,.35);padding:10px;border-radius:8px;max-width:75%;position:relative}
    .meta{font-size:.75rem;color:var(--muted);margin-bottom:4px}
    .time{font-size:.7rem;color:var(--muted);text-align:right;margin-top:4px}
    img.content-image{max-width:320px;border-radius:8px;margin-top:6px}

    .delete-btn{
      position:absolute;
      top:6px; right:6px;
      background:#c0392b;
      border:none;
      color:#fff;
      font-size:.7rem;
      padding:2px 6px;
      border-radius:6px;
      cursor:pointer;
    }

    .composer{position:fixed;bottom:0;left:0;right:0;background:rgba(0,0,0,.4);padding:12px}
    .composer-inner{max-width:980px;margin:auto;display:flex;gap:8px}
    input[type=text]{flex:1;padding:10px;border-radius:8px;border:none}
    button{border:none;border-radius:8px;padding:10px 14px;font-weight:700;cursor:pointer}
    .send-btn{background:var(--u0);color:#fff}
    .image-btn{background:var(--o0);color:#000}
  </style>
</head>
<body>

<div class="container">
  <div class="header">
    <div>
      <strong>Helooow, this is just a test</strong><br>
      <span style="color:var(--muted)">i'm testing this global chat, where u can send messages and images, so pls no nsfw or weird things.</span>
    </div>
    <div id="userLabel"></div>
  </div>

  <div id="chat" class="chat"></div>
</div>

<div class="composer">
  <div class="composer-inner">
    <input id="msgInput" type="text" placeholder="Type a message..." />
    <input id="fileInput" type="file" accept="image/*" hidden />
    <button class="image-btn" id="imageBtn">Image</button>
    <button class="send-btn" id="sendBtn">Send</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
const app = firebase.initializeApp({
  databaseURL:"https://fire-tavern-default-rtdb.firebaseio.com/"
});
const db = firebase.database();

const STORAGE_KEY="fire_forum_user";
let username = localStorage.getItem(STORAGE_KEY) || "Guest_"+Math.floor(Math.random()*9999);
document.getElementById("userLabel").textContent="Signed in as: "+username;

const chat=document.getElementById("chat");

function addMessage(key,data){
  const wrap=document.createElement("div");
  wrap.className="msg";

  const avatar=document.createElement("div");
  avatar.className="avatar";
  avatar.textContent=data.user.slice(0,2).toUpperCase();

  const bubble=document.createElement("div");
  bubble.className="bubble";

  bubble.innerHTML=`<div class="meta">${data.user}</div>`;

  if(data.message){
    bubble.innerHTML+=`<div>${data.message}</div>`;
  }
  if(data.image){
    bubble.innerHTML+=`<img class="content-image" src="${data.image}">`;
  }

  bubble.innerHTML+=`<div class="time">${new Date(data.ts).toLocaleString()}</div>`;

  if(username === "ishval"){
    const del=document.createElement("button");
    del.className="delete-btn";
    del.textContent="DEL";
    del.onclick=()=>firebase.database().ref("alivechat/"+key).remove();
    bubble.appendChild(del);
  }

  wrap.appendChild(avatar);
  wrap.appendChild(bubble);
  chat.appendChild(wrap);
  chat.scrollTop=chat.scrollHeight;
}

firebase.database().ref("alivechat").limitToLast(400).on("child_added",snap=>{
  addMessage(snap.key,snap.val());
});

document.getElementById("sendBtn").onclick=()=>{
  const v=msgInput.value.trim();
  if(!v)return;
  firebase.database().ref("alivechat").push({
    user:username,message:v,image:null,ts:Date.now()
  });
  msgInput.value="";
};

document.getElementById("imageBtn").onclick=()=>fileInput.click();
fileInput.onchange=e=>{
  const f=e.target.files[0];
  if(!f)return;
  const r=new FileReader();
  r.onload=()=>firebase.database().ref("alivechat").push({
    user:username,message:null,image:r.result,ts:Date.now()
  });
  r.readAsDataURL(f);
};
</script>

</body>
</html>
