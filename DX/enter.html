<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Fire's Forum</title>
  <link rel="icon" href="https://cdn.discordapp.com/attachments/1326638981319753798/1454484621688438967/Untitled995_20251227113851.png" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.cdnfonts.com/css/coolvetica" rel="stylesheet" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg-dark: #1A1D23;
      --accent: #FF8B44;
      --accent-dark: #2B223E;
      --success: #00FF00;
      --error: #FF8B44;
    }

    html,body{ height:100%; margin:0; }

    body {
      font-family: 'Coolvetica', sans-serif;
      margin: 0;
      height: 100vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #ffffff;
      text-align: center;
      position: relative;
      background-color: var(--bg-dark);
    }

    /* Fundo animado */
    .bg-image, .fg-image {
      position: absolute;
      left: 50%;
      width: 100vw;
      height: 120vh;
      object-fit: cover;
      transform: translateX(-50%) translateY(-10%);
      pointer-events: none;
      user-select: none;
    }
    .bg-image { top:-5%; z-index:-3; animation: moveBG 28s cubic-bezier(.25,.1,.25,1) infinite alternate; opacity:1; filter: blur(0.4px) saturate(1.02); }
    .fg-image { top:-6%; z-index:-2; animation: moveFG 22s cubic-bezier(.25,.1,.25,1) infinite alternate-reverse; opacity:0.98; }

    @keyframes moveBG { 0%{transform:translateX(-50%) translateY(-7%)} 100%{transform:translateX(-50%) translateY(-4%)} }
    @keyframes moveFG { 0%{transform:translateX(-50%) translateY(-8%)} 100%{transform:translateX(-50%) translateY(-5%)} }

    /* Conteúdo */
    .content { position: relative; z-index: 0; display:flex; flex-direction:column; align-items:center; gap: 8px; padding: 12px; }
    img.title-img { width: 180px; margin-bottom: 6px; }
    h1 { font-size: 3.2rem; margin: 0; line-height:1; display:flex; gap:8px; align-items:center; justify-content:center; }
    p { font-size:1rem; max-width:680px; margin:4px 0 12px 0; opacity:0.95; }
    c { font-size:0.95rem; display:block; margin-bottom:8px; opacity:0.95; }

    img.emoji { width:1em; height:1em; vertical-align:middle; }
    img.wave-emoji { width:1.7em; height:1em; vertical-align:middle; }

    .input-container { margin:12px 0; display:flex; flex-direction:column; gap:10px; width:clamp(280px,46vw,520px); z-index:1; background:rgba(0,0,0,0.18); padding:14px; border-radius:10px; box-shadow:0 6px 18px rgba(0,0,0,0.6); backdrop-filter: blur(6px) saturate(0.9); }

    input { padding:12px 14px; font-size:1rem; border:none; border-radius:8px; outline:none; background:rgba(255,255,255,0.03); color:#fff; }
    input::placeholder { color: rgba(255,255,255,0.45); }

    button { padding:12px; font-size:1rem; border:none; border-radius:8px; background-color:var(--accent); color:var(--accent-dark); cursor:pointer; font-weight:700; }
    button:active{ transform: translateY(1px); }

    .error { color:var(--error); font-size:0.95rem; margin-top:6px; min-height:1.1em; }

    /* Loading Dots */
    .loading-wrap { display:flex; justify-content:center; margin-top:6px; }
    .container { --uib-size:47px; --uib-color:var(--accent); --uib-speed:1s; display:flex; align-items:flex-end; justify-content:space-between; height:calc(var(--uib-size)*0.5); width:var(--uib-size); visibility:hidden; transition:opacity 160ms ease; opacity:0; }
    .container.visible{ visibility:visible; opacity:1; }
    .dot{ flex-shrink:0; width:calc(var(--uib-size)*0.17); height:calc(var(--uib-size)*0.17); border-radius:50%; background-color:var(--uib-color); }

    .dot:nth-child(1){ animation: jump var(--uib-speed) ease-in-out calc(var(--uib-speed)*-0.45) infinite; }
    .dot:nth-child(2){ animation: jump var(--uib-speed) ease-in-out calc(var(--uib-speed)*-0.3) infinite; }
    .dot:nth-child(3){ animation: jump var(--uib-speed) ease-in-out calc(var(--uib-speed)*-0.15) infinite; }
    .dot:nth-child(4){ animation: jump var(--uib-speed) ease-in-out infinite; }

    @keyframes jump { 0%,100%{ transform: translateY(0); } 50%{ transform: translateY(-160%); } }

    .credits { position:absolute; bottom:10px; left:50%; transform:translateX(-50%); font-size:0.95rem; color:#fff; display:flex; gap:8px; align-items:center; z-index:2; background:rgba(0,0,0,0.25); padding:6px 10px; border-radius:8px; backdrop-filter: blur(4px); }
    .credits img{ width:22px; height:22px; border-radius:4px; }

    @media (max-width:520px){ h1{ font-size:2.2rem } img.title-img{ width:140px } .input-container{ width:calc(92vw) } }
  </style>
</head>
<body>
  <!-- cleaned image URLs (no stray trailing ampersand) -->
  <img src="https://cdn.discordapp.com/attachments/1326638981319753798/1454475733039583317/1004_Sem_Titulo_20251227104553.png" class="bg-image" alt="background back">
  <img src="https://cdn.discordapp.com/attachments/1326638981319753798/1454475771547484374/1004_Sem_Titulo_20251227104556.png" class="fg-image" alt="background front">

  <main class="content" role="main" aria-labelledby="title">
    <img src="https://cdn.discordapp.com/attachments/1326638981319753798/1454484621688438967/Untitled995_20251227113851.png" alt="Fire's Forum icon" class="title-img" />
    <h1 id="title">Fire's Forum <img src="https://cdn.discordapp.com/attachments/1326638981319753798/1454473171947360360/image_search_1766843507156.gif" alt="wave" class="wave-emoji" /></h1>

    <p>
      welcome to Fire's Forum, a very cool place ig
      <img src="https://cdn.discordapp.com/attachments/1326638981319753798/1454473186946187386/image_search_1766843565777.gif" alt="anoy" class="emoji" />
      <br>
      here it's like Twitter or smth — to start, enter an account
      <img src="https://cdn.discordapp.com/emojis/1175642878207340565.gif" alt="hungry" class="emoji" />
    </p>

    <c>Enter an account username & password — if the account doesn't exist you'll create one.</c>

    <div class="input-container" role="form" aria-label="login form">
      <input type="text" id="username" placeholder="Username" autocomplete="username" />
      <input type="password" id="password" placeholder="Password" autocomplete="current-password" />
      <button id="enterBtn" type="button">Enter</button>
      <div class="error" id="error-msg" aria-live="polite"></div>

      <div class="loading-wrap" aria-hidden="true">
        <div class="container" id="loading">
          <div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div>
        </div>
      </div>
    </div>
  </main>

  <div class="credits" aria-hidden="false">
    <span class="by">by</span>
    <img src="https://cdn.discordapp.com/attachments/1326638981319753798/1454484626147119256/Untitled995_20251227113649.png" alt="fstudio">
    <span>fstudio</span>
    <span>&nbsp;and&nbsp;</span>
    <img src="https://cdn.discordapp.com/attachments/1326638981319753798/1454484919991402610/ish.png" alt="ishval">
    <span>Ishval</span>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script>
    // minimal config
    const firebaseConfig = { databaseURL: "https://fire-tavern-default-rtdb.firebaseio.com/" };
    const app = firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    const loadingEl = document.getElementById('loading');
    const errorEl = document.getElementById('error-msg');
    const enterBtn = document.getElementById('enterBtn');

    function showLoading(show){
      if(show){
        loadingEl.classList.add('visible');
      } else {
        loadingEl.classList.remove('visible');
      }
    }

    // because enter.html is inside DX/ and home.html is also inside DX/
    // use relative path to home
    const redirectPath = "./home.html";
    const STORAGE_KEY = "fire_forum_user";

    enterBtn.addEventListener('click', confirmAccount);
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        const active = document.activeElement;
        if (active && active.tagName !== 'BUTTON') confirmAccount();
      }
    });

    // auto-login attempt on load
    window.addEventListener('DOMContentLoaded', () => {
      console.log('enter.html loaded');
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        console.log('found saved user -> try auto login:', saved);
        tryAutoLogin(saved);
      }
    });

    function tryAutoLogin(savedUsername){
      showLoading(true);
      errorEl.style.color = getComputedStyle(document.documentElement).getPropertyValue('--success') || '#00FF00';
      errorEl.textContent = `Auto-login as ${savedUsername}...`;

      const userRef = database.ref('users/' + encodeURIComponent(savedUsername));
      userRef.get().then((snap) => {
        if (snap.exists()) {
          console.log('auto-login: user exists, redirecting to', redirectPath);
          setTimeout(() => { window.location.href = redirectPath; }, 700);
        } else {
          console.log('auto-login: saved user not found, clearing storage');
          localStorage.removeItem(STORAGE_KEY);
          errorEl.style.color = getComputedStyle(document.documentElement).getPropertyValue('--error') || '#FF8B44';
          errorEl.textContent = "Saved account not found anymore.";
          setTimeout(() => { errorEl.textContent = ""; }, 1600);
        }
      }).catch((err) => {
        console.error('auto-login error', err);
        errorEl.style.color = getComputedStyle(document.documentElement).getPropertyValue('--error') || '#FF8B44';
        errorEl.textContent = "Connection issue while auto-login.";
        setTimeout(() => { errorEl.textContent = ""; }, 1600);
      }).finally(() => {
        setTimeout(() => showLoading(false), 700);
      });
    }

    function confirmAccount(){
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value.trim();
      errorEl.textContent = "";
      errorEl.style.color = "";

      if (!username || !password) {
        errorEl.style.color = getComputedStyle(document.documentElement).getPropertyValue('--error') || '#FF8B44';
        errorEl.textContent = "Fill the informations please...";
        return;
      }

      showLoading(true);
      let willRedirect = false;

      const userRef = database.ref('users/' + encodeURIComponent(username));
      userRef.get().then((snapshot) => {
        if (snapshot.exists()) {
          const val = snapshot.val();
          const storedPwd = (val && typeof val === 'object' && 'password' in val) ? val.password : (typeof val === 'string' ? val : null);

          if (storedPwd !== null && storedPwd === password) {
            try { localStorage.setItem(STORAGE_KEY, username); } catch(e){ console.warn("localStorage error", e); }
            errorEl.style.color = getComputedStyle(document.documentElement).getPropertyValue('--success') || '#00FF00';
            errorEl.textContent = "Log-in... Redirecting";
            willRedirect = true;
            setTimeout(() => { window.location.href = redirectPath; }, 900);
          } else {
            errorEl.style.color = getComputedStyle(document.documentElement).getPropertyValue('--error') || '#FF8B44';
            errorEl.textContent = "Wrong password or maybe the account username already exists";
          }
        } else {
          // create account
          userRef.set({ password: password })
            .then(() => {
              try { localStorage.setItem(STORAGE_KEY, username); } catch(e){ console.warn("localStorage error", e); }
              errorEl.style.color = getComputedStyle(document.documentElement).getPropertyValue('--success') || '#00FF00';
              errorEl.textContent = "Account Created! Redirecting...";
              willRedirect = true;
              setTimeout(() => { window.location.href = redirectPath; }, 900);
            })
            .catch((err) => {
              console.error('create user error', err);
              errorEl.style.color = getComputedStyle(document.documentElement).getPropertyValue('--error') || '#FF8B44';
              errorEl.textContent = "Error creating account!";
            });
        }
      }).catch((err) => {
        console.error('confirmAccount error', err);
        errorEl.style.color = getComputedStyle(document.documentElement).getPropertyValue('--error') || '#FF8B44';
        errorEl.textContent = "Error connecting to Firebase!";
      }).finally(() => {
        setTimeout(() => {
          if (!willRedirect) showLoading(false);
        }, 600);
      });
    }

    // handy debug: quick link to home for manual testing (click console link)
    console.log('If redirection fails, open this in console to go to home manually: window.location.href = "', redirectPath, '"');
  </script>
</body>
</html>
