<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Fire's Forum — Install</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#FF8B44">
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <!-- Icon -->
  <link rel="icon" href="https://cdn.discordapp.com/attachments/1326638981319753798/1454484621688438967/Untitled995_20251227113851.png">

  <!-- Font -->
  <link href="https://fonts.cdnfonts.com/css/coolvetica" rel="stylesheet">

  <style>
    :root {
      --bg-dark: #1A1D23;
      --accent: #FF8B44;
      --accent-dark: #2B223E;
      --card-bg: rgba(0,0,0,0.36);
      --text-muted: rgba(255,255,255,0.85);
    }
    html,body{height:100%;margin:0}
    body{
      font-family: 'Coolvetica', sans-serif;
      background: var(--bg-dark);
      color:#fff;
      height:100vh;
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      text-align:center;
    }

    /* Background images */
    .bg-image, .fg-image {
      position:absolute;
      left:50%;
      width:100vw;
      height:120vh;
      object-fit:cover;
      transform:translateX(-50%) translateY(-10%);
      pointer-events:none;
      user-select:none;
    }
    .bg-image { top:-5%; z-index:-3; animation: moveBG 28s cubic-bezier(.25,.1,.25,1) infinite alternate; filter: blur(.4px) saturate(1.02); }
    .fg-image { top:-6%; z-index:-2; animation: moveFG 22s cubic-bezier(.25,.1,.25,1) infinite alternate-reverse; opacity:.98; }

    @keyframes moveBG { 0%{transform:translateX(-50%) translateY(-7%)} 100%{transform:translateX(-50%) translateY(-4%)} }
    @keyframes moveFG { 0%{transform:translateX(-50%) translateY(-8%)} 100%{transform:translateX(-50%) translateY(-5%)} }

    /* Card */
    .card {
      width: clamp(300px, 56vw, 520px);
      background: var(--card-bg);
      padding: 22px;
      border-radius:14px;
      box-shadow: 0 18px 40px rgba(0,0,0,0.6);
      z-index:1;
      backdrop-filter: blur(6px);
    }

    .logo { width:140px; margin:0 auto 10px auto; display:block; }
    h1 { font-size:2.2rem; margin:6px 0; display:flex; gap:10px; align-items:center; justify-content:center; }
    .wave { width:1.7em; height:1em; vertical-align:middle; }
    p { margin:10px 0 18px; color:var(--text-muted); line-height:1.25; }
    .hint { color:rgba(255,255,255,0.8); margin-bottom:18px; font-size:0.95rem }

    .actions { display:flex; gap:10px; justify-content:center; align-items:center; flex-wrap:wrap; }
    .btn {
      background:var(--accent);
      color:var(--accent-dark);
      border:none;
      padding:12px 18px;
      border-radius:10px;
      font-weight:700;
      cursor:pointer;
      font-size:1rem;
    }
    .btn.ghost {
      background:transparent;
      color:#fff;
      border:1px solid rgba(255,255,255,0.08);
    }

    .note { margin-top:12px; font-size:0.9rem; color:rgba(255,255,255,0.78) }

    /* credits */
    .credits {
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      bottom:10px;
      z-index:2;
      background: rgba(0,0,0,0.22);
      padding:6px 10px;
      border-radius:8px;
      display:flex;
      gap:8px;
      align-items:center;
      font-size:0.9rem;
    }
    .credits img { width:20px; height:20px; border-radius:4px }

    @media (max-width:520px){
      h1{font-size:1.5rem}
      .logo{width:120px}
      .card{padding:16px}
    }
  </style>
</head>
<body>
  <!-- background images (the same ones you used) -->
  <img class="bg-image" src="https://cdn.discordapp.com/attachments/1326638981319753798/1454475733039583317/1004_Sem_Titulo_20251227104553.png?ex=69513995&is=694fe815&hm=c43ea7fd484e42cf3da788900e6e3af021f889b82e1f907828567752f1c7fa7d&" alt="bg back">
  <img class="fg-image" src="https://cdn.discordapp.com/attachments/1326638981319753798/1454475771547484374/1004_Sem_Titulo_20251227104556.png?ex=6951399e&is=694fe81e&hm=fed21d231cbafed279fd4393045f1669bbbd98046cc011c6b6b91e604b1f08ca&" alt="bg front">

  <div class="card" id="card">
    <img class="logo" src="https://cdn.discordapp.com/attachments/1326638981319753798/1454484621688438967/Untitled995_20251227113851.png?ex=695141dc&is=694ff05c&hm=b22c193811838d00a07637caf05e4c4a4e10354dd694d336aa2a62b4095106de&" alt="Fire's Forum">
    <h1 id="title">Helooow <img class="wave" src="https://cdn.discordapp.com/attachments/1326638981319753798/1454473171947360360/image_search_1766843507156.gif?ex=69513732&is=694fe5b2&hm=225a9f4a5fe055b06c5249e03b392f18f86bee36b52f6a8b111a7602759a10b5&" alt="wave"></h1>

    <p id="mainText">
      To access Fire's Forum, you must install the app.<br>
      Installing creates a home-screen shortcut and opens in app mode (fullscreen).
    </p>

    <div class="hint" id="hintText">Use Chrome / Edge (Android or Desktop) for best installation support. iOS has limited PWA support.</div>

    <div class="actions" id="actions">
      <button class="btn" id="installBtn" style="display:none">Install</button>
      <button class="btn ghost" id="openManual" style="display:none">How to install</button>
    </div>

    <div class="note" id="statusNote" aria-live="polite"></div>
  </div>

  <div class="credits">
    by <img src="https://cdn.discordapp.com/attachments/1326638981319753798/1454484626147119256/Untitled995_20251227113649.png?ex=695141dd&is=694ff05d&hm=96515b9df1f8ae4cc119687439df342bf5a7c5861f5a7bf155a92e2c6a15bd9c&" alt="fstudio"> fstudio and
    <img src="https://cdn.discordapp.com/attachments/1326638981319753798/1454484919991402610/ish.png?ex=69514223&is=694ff0a3&hm=91620e9ad91c5bcb08cf552b2a810dd24da3dd24133e12b1045e3160ef3022f9&" alt="ish"> Ishval
  </div>

  <script>
    // register service worker (must exist)
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js')
          .then(() => console.log('Service Worker registered'))
          .catch(e => console.warn('SW registration failed', e));
      });
    }

    // helpers
    function isInstalled() {
      return window.matchMedia('(display-mode: standalone)').matches ||
             window.navigator.standalone === true;
    }

    // If opened as installed app (standalone) -> go to DX/enter.html
    // This check runs on load; it ensures only installed-apps get redirected.
    window.addEventListener('DOMContentLoaded', () => {
      if (isInstalled()) {
        // small delay so user sees something then redirect
        setTimeout(() => { window.location.href = 'DX/enter.html'; }, 300);
        return;
      }
    });

    // UI elements
    const installBtn = document.getElementById('installBtn');
    const openManual = document.getElementById('openManual');
    const statusNote = document.getElementById('statusNote');

    // beforeinstallprompt flow
    let deferredPrompt = null;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;

      // show install UI if query ?install=1 OR if browser supports it
      const params = new URLSearchParams(location.search);
      if (params.get('install') === '1' || true) {
        showInstallUI();
      }
    });

    // If the page is opened with ?install=1 but the browser didn't fire beforeinstallprompt,
    // show manual instructions button after a short delay.
    const params = new URLSearchParams(location.search);
    if (params.get('install') === '1') {
      setTimeout(() => {
        if (!deferredPrompt && !isInstalled()) {
          openManual.style.display = 'inline-block';
          installBtn.textContent = 'Show install instructions';
          installBtn.style.display = 'inline-block';
        }
      }, 700);
    }

    // appinstalled event: show note but DO NOT redirect here (we only redirect when app is opened as standalone)
    window.addEventListener('appinstalled', () => {
      statusNote.textContent = 'App installed successfully. Open it from your home screen to continue.';
    });

    function showInstallUI() {
      installBtn.style.display = 'inline-block';
      openManual.style.display = 'none';
      statusNote.textContent = '';
    }

    installBtn.addEventListener('click', async () => {
      // if already installed (edge case), go straight to enter
      if (isInstalled()) {
        window.location.href = 'DX/enter.html';
        return;
      }

      // if we have the beforeinstallprompt event, prompt it
      if (deferredPrompt) {
        deferredPrompt.prompt();
        const choice = await deferredPrompt.userChoice;
        if (choice.outcome === 'accepted') {
          statusNote.textContent = 'Thank you! The app was accepted. Open it from your home screen to continue.';
        } else {
          statusNote.textContent = 'Installation dismissed. You can install later from the menu.';
        }
        deferredPrompt = null;
        // keep the page visible — we do NOT redirect here
      } else {
        // fallback: show manual instructions
        openManual.style.display = 'inline-block';
        if (installBtn.textContent.indexOf('Show') === -1) installBtn.textContent = 'Show install instructions';
      }
    });

    openManual.addEventListener('click', () => {
      const ua = navigator.userAgent || '';
      if (/Android/i.test(ua)) {
        alert('On Android (Chrome): open the browser menu (⋮) → Add to Home screen → Confirm.');
      } else if (/Chrome|Edge|Brave/i.test(ua) && /Windows|Mac|Linux/i.test(ua)) {
        alert('On desktop Chrome/Edge: click the install icon in the address bar or menu ⋮ → Install.');
      } else if (/iPhone|iPad|iPod/i.test(ua)) {
        alert('On iOS (Safari): tap the Share icon → Add to Home Screen. (iOS has limited PWA support).');
      } else {
        alert('Try Chrome/Edge on Android or Desktop for full install support.');
      }
    });

    // If the beforeinstallprompt never fired but the browser allows install UI later,
    // we still try to show the button after a short timeout.
    setTimeout(() => {
      if (!isInstalled() && deferredPrompt) showInstallUI();
    }, 600);
  </script>
</body>
</html>
